<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Mel's Meal Coach Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin:0; background:#ffffff; color:#222; display:flex; flex-direction:column; height:100vh; }
    header { padding:12px 16px; background:#ffffff; border-bottom:1px solid #e6e6e6; font-weight:700; text-align:center; }
    #topbar { display:flex; gap:8px; align-items:center; justify-content:center; padding:8px 12px; background:#fff; border-bottom:1px solid #eee; }
    #modelUsed { font-size:12px; color:#666; }
    #chat { flex:1; overflow:auto; padding:16px; background:#fafafa; display:flex; flex-direction:column; gap:10px; }
    .msg { padding:10px 14px; border-radius:14px; max-width: 800px; line-height:1.5; white-space:pre-wrap; }
    .user { align-self:flex-end; background:#e6f4ff; color:#1a1a1a; }
    .ai { align-self:flex-start; background:#f1f1f1; color:#1a1a1a; }
    #composerWrap { background:#fff; border-top:1px solid #e6e6e6; padding:12px; }
    #composer { display:flex; gap:8px; max-width: 980px; margin:0 auto; }
    textarea { flex:1; resize:none; padding:12px; border-radius:12px; border:1px solid #ccc; background:#fff; color:#222; min-height:56px; }
    button { padding:12px 16px; border:none; border-radius:10px; background:#10a37f; color:#fff; font-weight:600; cursor:pointer; }
    button:hover { background:#0d876a; }
    #actions { display:flex; gap:8px; align-items:center; justify-content:center; padding:8px 12px; background:#fff; border-top:1px solid #eee; }
    .linkish { background:#eef7f3; color:#0d876a; border:1px solid #cfe7dd; }
    .linkish:hover { background:#dff2ea; }
    @media (max-width: 640px) {
      #composer { flex-direction:column; }
      button { width:100%; }
    }

    /* thinking: animated . .. ... indicator */
    .thinking {
      display:none;                 /* hidden by default */
      opacity:.75;
      margin:6px 16px;              /* aligns with chat padding */
      font-size:14px;
      align-self:flex-start;        /* appear on AI side */
      color:#444;
    }
    .thinking::after {
      content:"...";
      animation:dots 1s steps(3,end) infinite;
    }
    @keyframes dots {
      0%   { content:"." }
      33%  { content:".." }
      66%  { content:"..." }
      100% { content:"" }
    }

    /* === Copy button (small, neutral) === */
    .copy-btn {
      margin-top:8px;
      padding:6px 10px;
      font-size:12px;
      line-height:1;
      border:1px solid #d6d6d6;
      border-radius:8px;
      background:#ffffff;
      color:#222;
      cursor:pointer;
    }
    .copy-btn:hover { background:#f0f0f0; }
    .copy-row {
      display:flex;
      justify-content:flex-end;
    }
  </style>
</head>
<body>
  <header>Mel's Meal Plan Coach Chat</header>

  <div id="topbar">
    <span id="modelUsed">(actual model: checking…)</span>
  </div>

  <div id="chat"></div>

  <!-- thinking: lives under the chat, shows while waiting -->
  <div id="thinking" class="thinking" aria-live="polite">Thinking</div>

  <div id="composerWrap">
    <form id="composer">
      <textarea id="input" placeholder="Tell me your calories & macro targets, foods you like/avoid, cooking time, budget, and meals/day…"></textarea>
      <button id="send" type="submit">Send</button>
    </form>
  </div>

  <div id="actions">
    <button id="reset" class="linkish" type="button">Clear Chat</button>
  </div>

  <script>
    const chatEl   = document.getElementById('chat');
    const form     = document.getElementById('composer');
    const input    = document.getElementById('input');
    const sendBtn  = document.getElementById('send');
    const resetBtn = document.getElementById('reset');
    const modelUsedEl = document.getElementById('modelUsed');
    const thinkingEl  = document.getElementById('thinking'); // thinking

    // Load or seed chat history
    let messages = [];
    try {
      messages = JSON.parse(localStorage.getItem('fam_msgs') || '[]');
    } catch { messages = []; }

    if (messages.length === 0) {
      messages.push({
        role: 'assistant',
        content:
`Hi! I’m your meal plan coach. Tell me:
• Calories & macro targets (protein/carbs/fat)
• Foods you like/avoid
• Cooking time & budget
• Number of meals/day

I’ll build and fine-tune a meal plan you can actually follow.`
      });
    }
    renderAll();

    resetBtn.onclick = () => {
      messages = [{
        role: 'assistant',
        content:
`Hi! I’m your meal plan coach. Tell me:
• Calories & macro targets (protein/carbs/fat)
• Foods you like/avoid
• Cooking time & budget
• Number of meals/day

I’ll build and fine-
