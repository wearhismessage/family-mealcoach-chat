<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Meal Plan Hero</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <!-- Google Fonts: Roboto (fallback to Arial/system if blocked) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

  <!-- Detect if running inside an iframe -->
  <script>
    (function () {
      try {
        if (window.top !== window.self) {
          document.documentElement.classList.add('embedded');
        }
      } catch (_) {
        document.documentElement.classList.add('embedded');
      }
    })();
  </script>

  <style>
    /* --- Global font (Roboto with fallbacks) --- */
    :root {
      --app-font: "Roboto", Arial, "Segoe UI", system-ui, -apple-system, "Noto Sans", sans-serif;
      --emoji-fonts: "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji";
    }

    /* --- global/mobile guards --- */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin:0; background:#fff; color:#222; display:flex; flex-direction:column; min-height:100dvh; overflow-x:hidden;
      font-family: var(--app-font), var(--emoji-fonts);
    }

    /* Ensure controls inherit font */
    button, input, select, textarea { font: inherit; }

    /* Header (hidden when embedded) */
    header {
      padding:8px 10px;            /* tighter */
      background:#fff;
      border-bottom:1px solid #e6e6e6;
      font-weight:700;
      text-align:center;
      line-height:1.2;
    }
    .embedded header { display:none; }

    /* Chat area */
    #chat {
      flex:1;
      overflow:auto;
      padding:10px;
      background:#fafafa;
      display:flex;
      flex-direction:column;
      gap:8px;
      -webkit-overflow-scrolling: touch;
    }

    .msg { 
      position:relative; 
      padding:8px 12px; 
      border-radius:14px; 
      max-width:800px; 
      line-height:1.35; 
      min-width:0;              /* FIX: allow full shrink inside flex column */
    }

    /* Hug edges + swapped colors + chat-tail shape */
    .user {
      align-self:flex-end;
      background:#f1f1f1;   /* user bubble color */
      color:#1a1a1a;
      margin-left:auto;     /* push to right edge */
      border-radius:18px 18px 4px 18px; /* subtle tail bottom-right */
    }
    .ai {
      align-self:flex-start;
      background:#e6f4ff;   /* AI bubble color */
      color:#1a1a1a;
      margin-right:auto;    /* push to left edge */
      border-radius:18px 18px 18px 4px; /* subtle tail bottom-left */
    }

    /* Inner content spacing (room for copy button) */
    .msg .content {
      white-space: pre-wrap;
      padding-right: 12px;      /* FIX: was 44px â€” let text use the width */
      padding-bottom: 20px;     /* keep some room for the copy button */
      overflow-wrap: break-word;
      word-break: normal;
      text-wrap: pretty;        /* progressive enhancement */
      hyphens: auto;
    }

    /* Composer (sticky + safe-area) */
    #composerWrap {
      position: sticky;
      bottom: 0;
      left: 0; right: 0;
      background:#fff;
      border-top:1px solid #e6e6e6;
      padding:8px 8px 12px;        /* extra bottom for safe-area */
      z-index: 5;
    }
    @supports (padding: max(0px)) {
      #composerWrap { padding-bottom: max(12px, env(safe-area-inset-bottom)); }
    }

    #composer {
      display:flex;
      flex-direction:column;
      gap:6px;
      max-width:980px;
      margin:0 auto;
      width:100%;
      min-width:0;                 /* prevent overflow on small screens */
    }

    textarea {
      flex:1 1 auto;
      width:100%;
      min-width:0;                 /* critical for mobile flex overflow */
      resize:none;
      padding:10px;
      border-radius:12px;
      border:1px solid #ccc;
      background:#fff;
      color:#222;
      min-height:52px;
      margin:0;
    }

    /* Side-by-side actions */
    .actions {
      display:flex;
      gap:6px;
      margin:0;
      align-items:center;
      flex-wrap:nowrap;            /* keep on one line */
      min-width:0;
    }
    .actions button {
      flex:1 1 0;
      padding:10px 14px;
      border:none;
      border-radius:10px;
      cursor:pointer;
      font-weight:600;
      white-space:nowrap;          /* avoid wrapping text that widens layout */
    }
    .actions .clear { background:#f0f5f0; color:#333; border:1px solid #cfe7dd; }
    .actions .clear:hover { background:#e8f2ec; }
    .actions .send { background:#10a37f; color:#fff; }
    .actions .send:hover { background:#0d876a; }

    /* Copy icon per bubble */
    .copyBtn {
      position:absolute; bo
